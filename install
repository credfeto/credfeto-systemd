#! /bin/sh

PROG=$0
die() {
    echo
    echo "$@"
    exit 1
}

BASEDIR="$(dirname "$(readlink -f "$0")")"
echo "Script Dir: $BASEDIR"


echo "Installing"...

echo "* Enabling IPV6 Privacy"
sudo cp "$BASEDIR/settings/networkmanager/ip6-privacy.conf" /etc/NetworkManager/conf.d/ip6-privacy.conf

echo "* Enabling MAC Privacy"
sudo cp "$BASEDIR/settings/networkmanager/wifi_rand_mac.conf" /etc/NetworkManager/conf.d/wifi_rand_mac.conf

echo "* Configuring network availibility check"
sudo cp "$BASEDIR/settings/networkmanager/connectivity-test.conf" /etc/NetworkManager/conf.d/connectivity-test.conf


echo "* Installing Network Manager Hook"
sudo cp "$BASEDIR/hooks/networkmanager/10-update-timesyncd" /etc/NetworkManager/dispatcher.d/10-update-timesyncd 

echo "* Installing Btrfs Scrub"
sudo cp "$BASEDIR/units/btrfs-scrub/btrfs-scrub.service" /etc/systemd/system/
sudo cp "$BASEDIR/units/btrfs-scrub/btrfs-scrub.timer" /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable --now btrfs-scrub.timer

echo "* Installing Pacman Sync"
sudo cp "$BASEDIR/units/pacman-sync/pacman-sync.service" /etc/systemd/system/
sudo cp "$BASEDIR/units/pacman-sync/pacman-sync.timer" /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable --now pacman-sync.timer



echo "Done"
